<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Data Scientist Agent</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box }
        body { font-family:Arial,sans-serif; background:#f5f7fa; padding:15px }
        .container { max-width:800px; margin:0 auto; background:white; border-radius:15px; box-shadow:0 5px 25px rgba(0,0,0,0.1); overflow:hidden }
        .header { background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:20px; text-align:center }
        .header h1 { font-size:24px; margin-bottom:8px }
        .upload-box { border:2px dashed #667eea; border-radius:12px; padding:30px; text-align:center; margin:20px; cursor:pointer; transition:all 0.3s }
        .upload-box:hover { background:#f8f9ff; border-color:#764ba2 }
        .upload-box input { display:none }
        .chat-box { height:300px; overflow-y:auto; padding:15px; margin:0 20px 15px; background:#f8f9fa; border-radius:12px }
        .message { margin-bottom:12px; padding:10px 15px; border-radius:18px; max-width:85% }
        .user { background:#667eea; color:white; margin-left:auto }
        .bot { background:#e9ecef; color:#333 }
        .input-area { display:flex; gap:10px; padding:0 20px 20px }
        .input-area input { flex:1; padding:12px 15px; border:1px solid #ddd; border-radius:25px; font-size:15px }
        .input-area button { background:#667eea; color:white; border:none; padding:12px 25px; border-radius:25px; cursor:pointer; font-weight:bold }
        .plot-area { text-align:center; padding:15px; border-top:1px solid #eee }
        .plot-area img { max-width:100%; border-radius:10px; display:none }
        .commands { background:#e3f2fd; padding:15px; border-radius:12px; margin:15px; font-size:14px }
        .commands h3 { margin-bottom:8px; color:#1976d2 }
        .commands ul { padding-left:20px }
        .commands li { margin-bottom:4px }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Data Scientist Agent</h1>
            <p>100% Offline ‚Ä¢ No API Keys ‚Ä¢ No Card Required</p>
        </div>
        
        <div class="upload-box" onclick="document.getElementById('fileInput').click()">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p style="margin-top:12px; font-size:16px">üìÅ Click to upload CSV file</p>
            <input type="file" id="fileInput" accept=".csv" onchange="uploadFile(this)">
        </div>
        
        <div class="commands">
            <h3>üí° Try These Commands:</h3>
            <ul>
                <li>'top 5 by revenue'</li>
                <li>'predict trend'</li>
                <li>'segment customers'</li>
                <li>'detect outliers price'</li>
                <li>'create bar chart'</li>
                <li>'show missing values'</li>
                <li>'clean data'</li>
                <li>'group by region'</li>
                <li>'total revenue'</li>
            </ul>
        </div>
        
        <div class="chat-box" id="chatBox">
            <div class="message bot">üëã Hello! Upload a CSV file to get started. I support 30+ commands for analysis, visualization, and insights ‚Äî all offline!</div>
        </div>
        
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type command (e.g., 'top 5 by revenue')..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">Send</button>
        </div>
        
        <div class="plot-area">
            <h3>üìä Plot</h3>
            <img id="plotImg" src="/static/plot.png?t=0" alt="Plot will appear here">
            <p id="plotStatus" style="color:#666; margin-top:10px">Upload data and type 'create bar chart' to see plot</p>
        </div>
    </div>

    <script>
        let uploaded = false;
        
        function uploadFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                addMessage(data.message, 'bot');
                uploaded = true;
                document.getElementById('fileInput').value = '';
            })
            .catch(error => {
                addMessage('‚ùå Upload failed: ' + error, 'bot');
            });
        }
        
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;
            
            if (!uploaded) {
                addMessage('‚ö†Ô∏è Please upload a CSV file first!', 'bot');
                return;
            }
            
            addMessage(message, 'user');
            input.value = '';
            
            fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: message})
            })
            .then(response => response.json())
            .then(data => {
                addMessage(data.response, 'bot');
                if (data.response.includes('Plot saved')) {
                    setTimeout(refreshPlot, 2000);
                }
            })
            .catch(error => {
                addMessage('‚ùå Error: ' + error, 'bot');
            });
        }
        
        function addMessage(text, sender) {
            const chatBox = document.getElementById('chatBox');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message ' + sender;
            msgDiv.textContent = sender === 'user' ? 'You: ' + text : 'Bot: ' + text;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        function refreshPlot() {
            const img = document.getElementById('plotImg');
            const timestamp = new Date().getTime();
            img.src = `/static/plot.png?t=${timestamp}`;
            img.style.display = 'block';
            document.getElementById('plotStatus').style.display = 'none';
        }
        
        // Auto-refresh plot every 10 seconds if visible
        setInterval(refreshPlot, 10000);
    </script>
</body>
</html>
